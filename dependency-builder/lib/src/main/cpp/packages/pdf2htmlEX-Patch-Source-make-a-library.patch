--- CMakeLists.txt	2019-10-15 12:57:08.368000000 -0000
+++ CMakeLists.txt	2019-10-15 12:59:03.582000000 -0000
@@ -2,9 +2,9 @@
 # set default build type to Release
 set(CMAKE_BUILD_TYPE Release CACHE STRING "Build configuration (Debug, Release, RelWithDebInfo, MinSizeRel)")

-project(pdf2htmlEX)
+cmake_minimum_required(VERSION 3.6.0 FATAL_ERROR)
+project(pdf2htmlEX VERSION "0.17.0")
 set(CMAKE_EXPORT_COMPILE_COMMANDS ON)
-cmake_minimum_required(VERSION 2.6.0 FATAL_ERROR)

 option(ENABLE_SVG "Enable SVG support, for generating SVG background images and converting Type 3 fonts" ON)

@@ -115,6 +115,7 @@
     src/Param.h
     src/pdf2htmlEX.cc
     src/pdf2htmlEX-config.h
+    src/public/pdf2htmlEX.h
     src/HTMLRenderer/HTMLRenderer.h
     src/HTMLRenderer/draw.cc
     src/HTMLRenderer/general.cc
@@ -172,7 +173,8 @@
     src/TmpFiles.cc
     )
 
-add_executable(pdf2htmlEX ${PDF2HTMLEX_SRC})
+add_library(pdf2htmlEX ${PDF2HTMLEX_SRC})
+set_target_properties(pdf2htmlEX PROPERTIES PUBLIC_HEADER src/public/pdf2htmlEX.h)
 target_link_libraries(pdf2htmlEX ${PDF2HTMLEX_LIBS})
 
 add_custom_target(pdf2htmlEX_resources ALL DEPENDS
@@ -198,7 +200,14 @@
         ${CMAKE_SOURCE_DIR}/share/fancy.css
     )
 
-install (TARGETS pdf2htmlEX DESTINATION bin)
+install (TARGETS pdf2htmlEX
+  LIBRARY DESTINATION lib
+  ARCHIVE DESTINATION lib
+  RUNTIME DESTINATION bin
+  PUBLIC_HEADER DESTINATION include)
+
+configure_file(${CMAKE_CURRENT_LIST_DIR}/pdf2htmlEX.pc.in ${CMAKE_CURRENT_BINARY_DIR}/pdf2htmlEX.pc @ONLY)
+install(FILES ${CMAKE_CURRENT_BINARY_DIR}/pdf2htmlEX.pc DESTINATION lib/pkgconfig)
 
 set(PDF2HTMLEX_RESOURCE
     ${CMAKE_SOURCE_DIR}/3rdparty/PDF.js/compatibility.js
--- /dev/null	2019-10-15 11:39:59.142000000 -0000
+++ pdf2htmlEX.pc.in	2019-10-15 19:19:12.108000000 -0000
@@ -0,0 +1,11 @@
+prefix=@CMAKE_INSTALL_PREFIX@
+libdir=${prefix}/lib
+includedir=${prefix}/include
+
+Name: @PROJECT_NAME@
+Description: @PROJECT_NAME@
+Version: @PROJECT_VERSION@
+
+Requires.private: cairo freetype libfontforge poppler
+Libs: -L${libdir} -lpdf2htmlEX
+Cflags: -I${includedir}
--- src/pdf2htmlEX.cc	2019-09-27 09:58:46.787000000 -0000
+++ src/pdf2htmlEX.cc	2019-09-27 09:59:18.711000000 -0000
@@ -346,7 +346,7 @@
     }
 }
 
-int main(int argc, char **argv)
+int pdf2htmlEX_main(int argc, char **argv)
 {
     // We need to adjust these directories before parsing the options.
 #if defined(__MINGW32__)
@@ -441,7 +441,5 @@
     Object::memCheck(stderr);
     gMemReport(stderr);
 
-    exit(finished ? (EXIT_SUCCESS) : (EXIT_FAILURE));
-
-    return 0;
+    return finished ? EXIT_SUCCESS : EXIT_FAILURE;
 }
--- /dev/null	2019-09-27 07:10:37.101000000 -0000
+++ src/public/pdf2htmlEX.h	2019-09-27 10:03:44.230000000 -0000
@@ -0,0 +1,4 @@
+#pragma once
+
+int pdf2htmlEX_main(int argc, char **argv);
+
